// Generated by CoffeeScript 1.8.0
(function() {
  var compileTag, gistTag;

  window.iframeAutoResize = function(id) {
    var delayPost;
    delayPost = function() {
      var doc, newheight;
      if (document.getElementById) {
        doc = document.getElementById(id).contentWindow.document.getElementsByClassName('gist')[0];
        if (!doc) {
          return;
        }
        newheight = doc.scrollHeight;
      }
      return document.getElementById(id).height = "" + newheight + "px";
    };
    return setTimeout(delayPost, 100);
  };

  gistTag = function(scope, elm, attrs) {
    var doc, gistId, iframe, iframeHtml;
    gistId = attrs.gist;
    iframe = document.createElement('iframe');
    iframe.id = "gist-" + gistId;
    iframe.setAttribute('width', '100%');
    iframe.setAttribute('frameborder', '0');
    iframe.setAttribute('onload', "iframeAutoResize('" + iframe.id + "')");
    elm[0].appendChild(iframe);
    iframeHtml = "<html>\n<head>\n  <base target=\"_parent\">\n  <style>\n  table {\n    font-size:12px;\n  }\n  .gist-file {\n    margin: 0 !important;\n  }\n  </style>\n</head>\n<body style=\"margin:0;\">\n  <script src=\"https://gist.github.com/" + gistId + ".js\"></script>\n</body>\n</html>";
    doc = iframe.document;
    if (iframe.contentDocument) {
      doc = iframe.contentDocument;
    } else if (iframe.contentWindow) {
      doc = iframe.contentWindow.document;
    }
    doc.open();
    doc.writeln(iframeHtml);
    return doc.close();
  };

  compileTag = function($compile) {
    return function(scope, element, attrs) {
      var ifChange, watchForChange;
      watchForChange = function(scope) {
        return scope.$eval(attrs.compile);
      };
      ifChange = function(value) {
        element.html(value);
        return $compile(element.contents())(scope);
      };
      return scope.$watch(watchForChange, ifChange);
    };
  };

  angular.module('sblogApp').directive('gist', function() {
    return gistTag;
  }).directive('compile', ['$compile', compileTag]);

}).call(this);
